{
  "version": 1,
  "defaults": {
    "mode_to_template": {
      "llm": "core",
      "core": "core",
      "archive": "archive",
      "custom": "gui"
    },
    "notes": [
      "规则按顺序匹配：第一条命中即生效（first-match-wins）。",
      "match 使用 glob（相对项目根目录），示例：core/**/*.py, apps/**/*.py。",
      "mode 支持：full | interface | head | skip。",
      "head 模式默认导出前 head_lines 行。",
      "interface 仅对 .py 做 AST 接口提取；其他文件降级为 head。",
      "archive 模板默认会额外生成 zip 归档（make_zip=true）。",
      "sections 支持 config/env/overview/tree/inventory/contents/stats 的输出开关。",
      "snapshot.py 支持 --focus 路径/通配符以聚焦导出（可多次传入）。"
    ]
  },
  "templates": {
    "core": {
      "desc": "LLM-friendly snapshot：核心业务代码完整 + 非核心接口/头部，包含项目全貌与进度。",
      "output": "project_context.txt",
      "redact": true,
      "include_reports": true,
      "hash": "embedded",
      "embed_order": "smart",
      "sections": {
        "config": false,
        "env": true,
        "overview": true,
        "tree": true,
        "inventory": true,
        "contents": true,
        "stats": true
      },
      "inventory": {
        "enabled": true,
        "scope": "included",
        "limit": 700
      },
      "pinned": [
        "PROJECT_STATUS.json",
        "README.md",
        "conf/settings.ini",
        "docs/DEV_GUIDE.md",
        "docs/ROADMAP.md",
        "apps/cli/registry.py"
      ],
      "max_file_bytes": 200000,
      "max_total_bytes": 1500000,
      "tree": {
        "max_depth": 8,
        "max_entries_per_dir": 250
      },
      "include_globs": [
        "README.md",
        "PROJECT_STATUS.json",
        ".gitignore",
        "conf/**/*.ini",
        "core/**/*.py",
        "apps/**/*.py",
        "devtools/**/*.py",
        "docs/**/*.md",
        "tests/**/*.py",
        "bin/**",
        "data/reports/**/*.md",
        "data/samples/**/*"
      ],
      "ignore_files": [
        "project_context.txt",
        ".DS_Store",
        "id_rsa",
        "id_ed25519",
        "known_hosts"
      ],
      "ignore_globs": [
        "data/snapshots/**",
        "**/*.swp",
        "**/*.swo",
        "**/*.tmp",
        "**/*.bak",
        "**/*.log",
        "**/*.zip",
        "**/*.tar",
        "**/*.tar.gz",
        "**/*.gz",
        "**/*.7z",
        "**/*.rar",
        "**/*.png",
        "**/*.jpg",
        "**/*.jpeg",
        "**/*.webp",
        "**/*.pdf",
        "**/*.mp4",
        "**/*.mov",
        "**/*.sqlite",
        "**/*.db",
        "**/.env",
        "**/.env.*",
        "**/*.pem",
        "**/*.key"
      ],
      "rules": [
        {
          "match": "devtools/snapshot.py",
          "mode": "full"
        },
        {
          "match": "core/engine.py",
          "mode": "full"
        },
        {
          "match": "core/analyzer.py",
          "mode": "full"
        },
        {
          "match": "apps/cli/explorer.py",
          "mode": "full"
        },
        {
          "match": "apps/cli/wiki.py",
          "mode": "full"
        },
        {
          "match": "apps/cli/registry.py",
          "mode": "full"
        },
        {
          "match": "core/**/*.py",
          "mode": "full"
        },
        {
          "match": "apps/**/*.py",
          "mode": "full"
        },
        {
          "match": "devtools/**/*.py",
          "mode": "interface"
        },
        {
          "match": "docs/**/*.md",
          "mode": "head",
          "head_lines": 240
        },
        {
          "match": "tests/**/*.py",
          "mode": "head",
          "head_lines": 220
        },
        {
          "match": "bin/**",
          "mode": "head",
          "head_lines": 160
        },
        {
          "match": "conf/**",
          "mode": "full"
        },
        {
          "match": "data/reports/**/*.md",
          "mode": "head",
          "head_lines": 260
        },
        {
          "match": "data/samples/**/*.md",
          "mode": "head",
          "head_lines": 340
        },
        {
          "match": "data/samples/**/*.json",
          "mode": "head",
          "head_lines": 160
        },
        {
          "match": "*.md",
          "mode": "head",
          "head_lines": 240
        },
        {
          "match": "*.txt",
          "mode": "head",
          "head_lines": 240
        },
        {
          "match": "**/*",
          "mode": "skip"
        }
      ]
    },
    "archive": {
      "desc": "Archival snapshot：尽量完整导出 + 生成 zip 归档（适合长期留存/回溯）。",
      "output": "data/snapshots/archive_{timestamp}.md",
      "make_zip": true,
      "zip_output": "data/snapshots/archive_{timestamp}.zip",
      "redact": true,
      "include_reports": true,
      "hash": "all",
      "embed_order": "path",
      "sections": {
        "config": true,
        "env": true,
        "overview": true,
        "tree": true,
        "inventory": true,
        "contents": true,
        "stats": true
      },
      "inventory": {
        "enabled": true,
        "scope": "all",
        "limit": 2000
      },
      "max_file_bytes": 500000,
      "max_total_bytes": 20000000,
      "tree": {
        "max_depth": 30,
        "max_entries_per_dir": 1000
      },
      "include_globs": [
        "**/*"
      ],
      "ignore_files": [
        "project_context.txt",
        ".DS_Store",
        "id_rsa",
        "id_ed25519",
        "known_hosts"
      ],
      "ignore_globs": [
        "data/snapshots/**",
        "**/*.swp",
        "**/*.swo",
        "**/*.tmp",
        "**/*.bak",
        "**/*.log",
        "**/*.zip",
        "**/*.tar",
        "**/*.tar.gz",
        "**/*.gz",
        "**/*.7z",
        "**/*.rar",
        "**/*.png",
        "**/*.jpg",
        "**/*.jpeg",
        "**/*.webp",
        "**/*.pdf",
        "**/*.mp4",
        "**/*.mov",
        "**/*.sqlite",
        "**/*.db",
        "**/.env",
        "**/.env.*",
        "**/*.pem",
        "**/*.key"
      ],
      "rules": [
        {
          "match": "**/*",
          "mode": "full"
        }
      ]
    },
    "focus_analyzer": {
      "desc": "聚焦：增强 analyzer 对更多 DST 数据类型的解析，并同步到 explorer/wiki。",
      "output": "project_context.focus_analyzer.txt",
      "redact": true,
      "include_reports": true,
      "hash": "embedded",
      "embed_order": "smart",
      "sections": {
        "config": false,
        "env": true,
        "overview": true,
        "tree": true,
        "inventory": true,
        "contents": true,
        "stats": true
      },
      "inventory": {
        "enabled": true,
        "scope": "included",
        "limit": 900
      },
      "max_file_bytes": 260000,
      "max_total_bytes": 2200000,
      "tree": {
        "max_depth": 10,
        "max_entries_per_dir": 300
      },
      "include_globs": [
        "PROJECT_STATUS.json",
        "README.md",
        "conf/**/*.ini",
        "core/**/*.py",
        "apps/**/*.py",
        "tests/**/*.py",
        "devtools/**/*.py",
        "data/reports/**/*.md",
        "data/samples/**/*"
      ],
      "ignore_files": [
        "project_context.txt",
        ".DS_Store",
        "id_rsa",
        "id_ed25519",
        "known_hosts"
      ],
      "ignore_globs": [
        "data/snapshots/**",
        "**/*.swp",
        "**/*.swo",
        "**/*.tmp",
        "**/*.bak",
        "**/*.log",
        "**/*.zip",
        "**/*.tar",
        "**/*.tar.gz",
        "**/*.gz",
        "**/*.7z",
        "**/*.rar",
        "**/*.png",
        "**/*.jpg",
        "**/*.jpeg",
        "**/*.webp",
        "**/*.pdf",
        "**/*.mp4",
        "**/*.mov",
        "**/*.sqlite",
        "**/*.db",
        "**/.env",
        "**/.env.*",
        "**/*.pem",
        "**/*.key"
      ],
      "rules": [
        {
          "match": "core/analyzer.py",
          "mode": "full"
        },
        {
          "match": "core/engine.py",
          "mode": "full"
        },
        {
          "match": "apps/cli/explorer.py",
          "mode": "full"
        },
        {
          "match": "apps/cli/wiki.py",
          "mode": "full"
        },
        {
          "match": "core/utils.py",
          "mode": "full"
        },
        {
          "match": "apps/cli/registry.py",
          "mode": "full"
        },
        {
          "match": "tests/**/*.py",
          "mode": "full"
        },
        {
          "match": "devtools/sampler.py",
          "mode": "full"
        },
        {
          "match": "devtools/codemap.py",
          "mode": "full"
        },
        {
          "match": "devtools/reporter.py",
          "mode": "interface"
        },
        {
          "match": "devtools/snapshot.py",
          "mode": "interface"
        },
        {
          "match": "devtools/**/*.py",
          "mode": "interface"
        },
        {
          "match": "conf/**",
          "mode": "full"
        },
        {
          "match": "data/reports/**/*.md",
          "mode": "full"
        },
        {
          "match": "data/samples/**/*.md",
          "mode": "head",
          "head_lines": 420
        },
        {
          "match": "data/samples/**/*.json",
          "mode": "head",
          "head_lines": 220
        },
        {
          "match": "bin/**",
          "mode": "skip"
        },
        {
          "match": "**/*",
          "mode": "skip"
        }
      ]
    },
    "gui": {
      "desc": "GUI generated template",
      "output": "project_context.txt",
      "redact": true,
      "include_reports": true,
      "sections": {
        "config": true,
        "env": true,
        "overview": true,
        "tree": true,
        "inventory": true,
        "contents": true,
        "stats": true
      },
      "max_file_bytes": 200000,
      "max_total_bytes": 1200000,
      "tree": {
        "max_depth": 8,
        "max_entries_per_dir": 250
      },
      "include_globs": [
        "**/*"
      ],
      "ignore_files": [
        ".DS_Store",
        "id_ed25519",
        "id_rsa",
        "known_hosts",
        "project_context.txt"
      ],
      "ignore_globs": [
        "data/snapshots/**",
        "**/*.swp",
        "**/*.swo",
        "**/*.tmp",
        "**/*.bak",
        "**/*.log",
        "**/*.zip",
        "**/*.tar",
        "**/*.tar.gz",
        "**/*.gz",
        "**/*.7z",
        "**/*.rar",
        "**/*.png",
        "**/*.jpg",
        "**/*.jpeg",
        "**/*.webp",
        "**/*.pdf",
        "**/*.mp4",
        "**/*.mov",
        "**/*.sqlite",
        "**/*.db",
        "**/.env",
        "**/.env.*",
        "**/*.pem",
        "**/*.key"
      ],
      "hash": "embedded",
      "embed_order": "smart",
      "inventory": {
        "enabled": true,
        "scope": "all",
        "limit": 700
      },
      "rules": [
        {
          "match": "data/reports/recipe_distribution.md",
          "mode": "skip"
        },
        {
          "match": "data/reports/catalog_summary.md",
          "mode": "skip"
        },
        {
          "match": "data/reports/asset_registry.md",
          "mode": "skip"
        },
        {
          "match": "data/reports/dst_codemap.json",
          "mode": "skip"
        },
        {
          "match": "data/reports/dst_codemap.md",
          "mode": "skip"
        },
        {
          "match": "conf/snapshot_templates.json",
          "mode": "interface"
        },
        {
          "match": "core/klei_atlas_tex.py",
          "mode": "interface"
        },
        {
          "match": "bin/.dst_tool.sh.swp",
          "mode": "skip"
        },
        {
          "match": "conf/settings.ini",
          "mode": "interface"
        },
        {
          "match": "bin/Wagstaff-Lab",
          "mode": "skip"
        },
        {
          "match": "bin/dst_tool.sh",
          "mode": "skip"
        },
        {
          "match": "apps/cli/explorer.py",
          "mode": "interface"
        },
        {
          "match": "apps/cli/registry.py",
          "mode": "interface"
        },
        {
          "match": "apps/cli/doctor.py",
          "mode": "interface"
        },
        {
          "match": "bin/wagstaff",
          "mode": "skip"
        },
        {
          "match": "apps/cli/guide.py",
          "mode": "skip"
        },
        {
          "match": "bin/boot.sh",
          "mode": "skip"
        },
        {
          "match": "apps/cli/wiki.py",
          "mode": "interface"
        },
        {
          "match": "bin/pm",
          "mode": "skip"
        },
        {
          "match": "PROJECT_STATUS.json",
          "mode": "skip"
        },
        {
          "match": ".gitignore",
          "mode": "interface"
        },
        {
          "match": "README.md",
          "mode": "skip"
        },
        {
          "match": "setup.sh",
          "mode": "skip"
        },
        {
          "match": "data/snapshots/**",
          "mode": "skip"
        },
        {
          "match": "conf/samples/**",
          "mode": "interface"
        },
        {
          "match": "data/reports/**",
          "mode": "skip"
        },
        {
          "match": "data/samples/**",
          "mode": "skip"
        },
        {
          "match": "data/static/**",
          "mode": "skip"
        },
        {
          "match": "data/index/**",
          "mode": "head",
          "head_lines": 200
        },
        {
          "match": "tests/**",
          "mode": "skip"
        },
        {
          "match": "conf/**",
          "mode": "skip"
        },
        {
          "match": "data/**",
          "mode": "interface"
        },
        {
          "match": "docs/**",
          "mode": "interface"
        },
        {
          "match": "bin/**",
          "mode": "skip"
        },
        {
          "match": "core/**",
          "mode": "full"
        },
        {
          "match": "apps/**",
          "mode": "full"
        },
        {
          "match": "**/*",
          "mode": "interface"
        }
      ]
    },
    "llm_best": {
      "desc": "LLM best (balanced): core code full + surrounding head/interface, low-noise inventory.",
      "output": "project_context.txt",
      "redact": true,
      "include_reports": true,
      "sections": {
        "config": false,
        "env": true,
        "overview": true,
        "tree": true,
        "inventory": true,
        "contents": true,
        "stats": true
      },
      "max_file_bytes": 250000,
      "max_total_bytes": 3000000,
      "tree": {
        "max_depth": 10,
        "max_entries_per_dir": 400
      },
      "include_globs": [
        "PROJECT_STATUS.json",
        "README.md",
        "bin/**/*",
        "conf/**/*",
        "conf/snapshot_templates.json",
        "data/index/**/*",
        "data/reports/**/*",
        "devtools/**/*",
        "docs/**/*",
        ".gitignore",
        "core/**/*",
        "apps/**/*",
        "tests/**/*"
      ],
      "ignore_files": [
        ".DS_Store",
        "id_ed25519",
        "id_rsa",
        "known_hosts",
        "project_context.txt"
      ],
      "ignore_globs": [
        "data/snapshots/**",
        "**/*.swp",
        "**/*.swo",
        "**/*.tmp",
        "**/*.bak",
        "**/*.log",
        "**/*.zip",
        "**/*.tar",
        "**/*.tar.gz",
        "**/*.gz",
        "**/*.7z",
        "**/*.rar",
        "**/*.png",
        "**/*.jpg",
        "**/*.jpeg",
        "**/*.webp",
        "**/*.pdf",
        "**/*.mp4",
        "**/*.mov",
        "**/*.sqlite",
        "**/*.db",
        "**/.env",
        "**/.env.*",
        "**/*.pem",
        "**/*.key"
      ],
      "hash": "embedded",
      "embed_order": "smart",
      "inventory": {
        "enabled": true,
        "scope": "included",
        "limit": 700
      },
      "rules": [
        {
          "match": "conf/snapshot_templates.json",
          "mode": "head",
          "head_lines": 10
        },
        {
          "match": "PROJECT_STATUS.json",
          "mode": "head",
          "head_lines": 260
        },
        {
          "match": "README.md",
          "mode": "head",
          "head_lines": 260
        },
        {
          "match": "gitignore",
          "mode": "head",
          "head_lines": 120
        },
        {
          "match": "data/reports/**",
          "mode": "head",
          "head_lines": 50
        },
        {
          "match": "data/samples/**",
          "mode": "skip"
        },
        {
          "match": "data/static/**",
          "mode": "skip"
        },
        {
          "match": "data/index/**",
          "mode": "head",
          "head_lines": 100
        },
        {
          "match": "devtools/**",
          "mode": "interface"
        },
        {
          "match": "tests/**",
          "mode": "head",
          "head_lines": 220
        },
        {
          "match": "conf/**",
          "mode": "full"
        },
        {
          "match": "docs/**",
          "mode": "head",
          "head_lines": 240
        },
        {
          "match": "core/**",
          "mode": "full"
        },
        {
          "match": "apps/**",
          "mode": "full"
        },
        {
          "match": "bin/**",
          "mode": "interface"
        },
        {
          "match": "**/*",
          "mode": "skip"
        }
      ],
      "pinned": [
        "README.md",
        "PROJECT_STATUS.json",
        "conf/settings.ini",
        "conf/snapshot_templates.json",
        "apps/cli/registry.py",
        "core/engine.py",
        "core/analyzer.py",
        "apps/cli/wiki.py",
        "apps/cli/explorer.py",
        "apps/webcraft/app.py",
        "apps/webcraft/api.py",
        "apps/webcraft/catalog_store.py",
        "apps/webcraft/planner.py"
      ]
    }
  }
}
